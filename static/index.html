<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Triangular Arbitrage Scanner</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    .container {
      width: 95%;
      max-width: 1000px;
      margin: 20px auto;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .exchanges {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    .exchange {
      background-color: #2c2c2c;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s;
    }
    .exchange.selected {
      background-color: #2196F3;
      color: white;
    }
    button {
      background-color: #2196F3;
      color: #fff;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
      margin-bottom: 15px;
    }
    button:hover {
      background-color: #1976D2;
    }
    pre {
      background-color: #1e1e1e;
      padding: 10px;
      border-radius: 5px;
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    #results {
      margin-top: 20px;
      padding: 10px;
      background-color: #222;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Triangular Arbitrage Scanner</h1>

    <div class="exchanges">
      <div class="exchange" onclick="toggleExchange(this)">Binance</div>
      <div class="exchange" onclick="toggleExchange(this)">Bybit</div>
      <div class="exchange" onclick="toggleExchange(this)">Kucoin</div>
      <div class="exchange" onclick="toggleExchange(this)">Gateio</div>
    </div>

    <button onclick="doScan()">Scan</button>
    <h3>Debug</h3>
    <pre id="debug"></pre>
    <h3>Results</h3>
    <div id="results"></div>
  </div>

  <script>
    const selectedExchanges = new Set();

    function toggleExchange(el) {
      const name = el.textContent;
      if (selectedExchanges.has(name)) {
        selectedExchanges.delete(name);
        el.classList.remove("selected");
      } else {
        selectedExchanges.add(name);
        el.classList.add("selected");
      }
    }

    async function doScan() {
      const debugEl = document.getElementById("debug");
      const resultsEl = document.getElementById("results");
      debugEl.textContent = "Starting GET /scan...";
      resultsEl.textContent = "";

      try {
        const exchanges = Array.from(selectedExchanges);
        const url = exchanges.length > 0
          ? `/scan?exchanges=${encodeURIComponent(exchanges.join(","))}`
          : `/scan`;

        const res = await fetch(url);
        if (!res.ok) {
          debugEl.textContent = `GET /scan failed: ${res.status}`;
          return;
        }
        const data = await res.json();
        debugEl.textContent = "GET /scan success";
        resultsEl.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        debugEl.textContent = "Error: " + err;
      }
    }
  </script>
</body>
</html>
